{"version":3,"sources":["webpack:///webpack/bootstrap e4f456376fdadeb3aeb9","webpack:///./www/js/analytics.js","webpack:///./www/js/lib/cookie.js","webpack:///./www/js/lib/cross-storage-client.js"],"names":["_gaq","_sf_async_config","_comscore","ANALYTICS","slideStartTime","Date","timeOnLastSlide","embedGa","i","s","o","g","r","a","m","q","push","arguments","l","createElement","getElementsByTagName","async","src","parentNode","insertBefore","window","document","setupVizAnalytics","ga","APP_CONFIG","VIZ_GOOGLE_ANALYTICS","ACCOUNT_ID","setupDotOrgAnalytics","NPR_GOOGLE_ANALYTICS","orientation","screenType","Modernizr","touch","station","get","customDimensions","TOPICS","PRIMARY_TOPIC","title","storage","onConnect","then","res","setDaysSinceFirstVisit","setFirstVisitDate","setOriginalLandingPage","setOriginalReferrer","firstDate","firstDateISO","substring","firstDateTime","now","oneDay","daysSince","Math","round","abs","getTime","toString","year","getFullYear","day","getDate","month","getMonth","dateString","set","url","S3_BASE_URL","referrerString","utmSource","getParameterByName","location","href","referrer","hostname","name","replace","regex","RegExp","results","exec","decodeURIComponent","setupGoogle","setupComscore","c1","c2","el","protocol","setupNielson","d","Image","onerror","onload","escape","join","setupChartbeat","uid","domain","loadChartbeat","_sf_endpt","e","setAttribute","body","appendChild","oldonload","trackEvent","eventName","label","value","eventData","PROJECT_SLUG","openShareDiscuss","closeShareDiscuss","clickTweet","clickFacebook","clickEmail","postComment","actOnFeaturedTweet","action","tweet_url","actOnFeaturedFacebook","post_url","copySummary","usedKeyboardNavigation","useKeyboardNavigation","completeTwentyFivePercent","completeFiftyPercent","completeSeventyFivePercent","completeOneHundredPercent","startFullscreen","stopFullscreen","begin","readyChromecast","startChromecast","stopChromecast","exitSlide","slide_index","currentTime","factory","define","exports","module","_OldCookies","Cookies","api","noConflict","extend","result","length","attributes","key","init","converter","path","defaults","expires","setMilliseconds","getMilliseconds","JSON","stringify","test","write","encodeURIComponent","String","cookie","toUTCString","secure","cookies","split","rdecode","parts","slice","charAt","read","json","parse","getJSON","apply","call","remove","withConverter","root","CrossStorageClient","opts","_id","_generateUUID","_promise","promise","Promise","_frameId","frameId","_origin","_getOrigin","_requests","_connected","_closed","_count","_timeout","timeout","_listener","_installListener","frame","getElementById","_poll","_createFrame","_hub","contentWindow","frameStyle","display","position","top","left","uri","origin","host","c","random","v","prototype","client","resolve","reject","Error","connect","setTimeout","err","clearTimeout","ttl","_request","args","Array","keys","del","clear","getKeys","close","removeChild","removeEventListener","detachEvent","message","error","response","data","indexOf","id","addEventListener","attachEvent","interval","targetOrigin","setInterval","clearInterval","postMessage","hasOwnProperty","style","method","params","req","originalToJSON","toJSON","amd"],"mappings":"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","file":"analytics.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap e4f456376fdadeb3aeb9","import Cookies from './lib/cookie.js';\nimport CrossStorageClient from './lib/cross-storage-client.js';\n\nvar _gaq = _gaq || [];\nvar _sf_async_config = {};\nvar _comscore = _comscore || [];\n\nvar ANALYTICS = (function () {\n\n    // Global time tracking variables\n    var slideStartTime =  new Date();\n    var timeOnLastSlide = null;\n\n    var embedGa = function() {\n        (function(i,s,o,g,r,a,m) {\n            i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){\n            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),\n            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)\n        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');\n    }\n\n    var setupVizAnalytics = function() {\n        ga('create', APP_CONFIG.VIZ_GOOGLE_ANALYTICS.ACCOUNT_ID, 'auto');\n        ga('send', 'pageview');\n    }\n\n    var setupDotOrgAnalytics = function() {\n        ga('create', APP_CONFIG.NPR_GOOGLE_ANALYTICS.ACCOUNT_ID, 'auto', 'dotOrgTracker');\n\n        var orientation = 'portrait';\n        if (window.orientation == 90 || window.orientation == -90) {\n            orientation = 'landscape';\n        }\n        var screenType = Modernizr.touch ? 'touch' : 'traditional';\n        var station = Cookies.get('station');\n\n        var customDimensions = {\n            'dimension1': null, // story ID (this is the SEAMUS ID)\n            'dimension2': APP_CONFIG.NPR_GOOGLE_ANALYTICS.TOPICS, // topics, see Google spreadsheet for ids. First id begins with P for primary\n            'dimension3': APP_CONFIG.NPR_GOOGLE_ANALYTICS.PRIMARY_TOPIC, // primary topic -- name of the topic, not the ID\n            'dimension4': null, // story theme, which is the html theme in Seamus\n            'dimension5': null, // program, english name of program\n            'dimension6': APP_CONFIG.NPR_GOOGLE_ANALYTICS.TOPICS, // parents, roll up program, theme, topics, etc.\n            'dimension7': null, // story tags\n            'dimension8': null, // byline\n            'dimension9': null, // content partner organization\n            'dimension10': null, // publish date, yyyymmddhh\n            'dimension11': null, // page type, seamus page type\n            'dimension12': null, // original referrer, from localstorage\n            'dimension13': null, // original landing page, from localstorage\n            'dimension14': station ? station : null, // localized station, read the cookie\n            'dimension15': null, // favorite station, read the cookie\n            'dimension16': null, // audio listener, from localstorage\n            'dimension17': null, // days since first session, from localstorage\n            'dimension18': null, // first session date, from localstorage\n            'dimension19': null, // registered user, from localstorage\n            'dimension20': null, // logged in sessions, from localstorage\n            'dimension21': null, // registration date, from localstorage\n            'dimension22': document.title, // story title\n            'dimension23': orientation, // screen orientation\n            'dimension24': screenType // screen type\n        };\n\n        var storage = new CrossStorageClient('http://www.npr.org/visuals/cross-storage-iframe.html');\n        storage.onConnect().then(function() {\n            return storage.get('firstVisitDate', 'hasListenedToAudio', 'isLoggedIn', 'isRegistered', 'originalLandingPage', 'originalReferrer', 'regDate');\n        }).then(function(res) {\n            customDimensions['dimension17'] = res[0] ?  setDaysSinceFirstVisit(storage, res[0]) : 0;\n            customDimensions['dimension18'] = res[0] ? res[0] : setFirstVisitDate(storage);\n            customDimensions['dimension16'] = res[1] ? res[1] : null;\n            customDimensions['dimension20'] = res[2] ? res[2] : null;\n            customDimensions['dimension19'] = res[3] ? res[3] : null;\n            customDimensions['dimension13'] = res[4] ? res[4] : setOriginalLandingPage(storage);\n            customDimensions['dimension12'] = res[5] ? res[5] :  setOriginalReferrer(storage);\n            customDimensions['dimension21'] = res[6] ? res[6] : null;\n            ga('dotOrgTracker.set', customDimensions);\n            ga('dotOrgTracker.send', 'pageview');\n        });\n    }\n\n    var setDaysSinceFirstVisit = function(storage, firstDate) {\n        var firstDateISO = firstDate.substring(0, 4) + '-' + firstDate.substring(4, 6) + '-' + firstDate.substring(6);\n        var firstDateTime = new Date(firstDateISO)\n        var now = new Date();\n\n        var oneDay = 24 * 60 * 60 * 1000;\n        var daysSince = Math.round(Math.abs((firstDateTime.getTime() - now.getTime())/(oneDay)));\n\n        return daysSince.toString();\n    }\n\n    var setFirstVisitDate = function(storage) {\n        var now = new Date();\n        var year = now.getFullYear().toString();\n        var day = now.getDate().toString();\n        var month = now.getMonth() + 1;\n        if (month < 10) {\n            month = '0' + month.toString();\n        }\n        var dateString = year + month + day;\n\n        storage.set('firstVisitDate', dateString);\n        return dateString;\n    }\n\n    var setOriginalLandingPage = function(storage) {\n        var url = APP_CONFIG.S3_BASE_URL;\n        storage.set('originalLandingPage', url);\n        return url;\n    }\n\n    var setOriginalReferrer = function(storage) {\n        var referrerString = null;\n\n        var utmSource = getParameterByName('utm_source', window.location.href);\n        if (utmSource) {\n            referrerString = utmSource;\n        } else {\n            var referrer = document.referrer;\n            if (!referrer) {\n                referrerString = 'direct';\n            } else {\n                var l = document.createElement('a');\n                l.href = referrer;\n                referrerString = l.hostname;\n            }\n        }\n\n        storage.set('originalReferrer', referrerString);\n        return referrerString;\n    }\n\n    function getParameterByName(name, url) {\n        if (!url) url = window.location.href;\n        name = name.replace(/[\\[\\]]/g, \"\\\\$&\");\n        var regex = new RegExp(\"[?&]\" + name + \"(=([^&#]*)|&|#|$)\"),\n            results = regex.exec(url);\n        if (!results) return null;\n        if (!results[2]) return '';\n        return decodeURIComponent(results[2].replace(/\\+/g, \" \"));\n    }\n\n    var setupGoogle = function() {\n        embedGa();\n        setupVizAnalytics();\n        setupDotOrgAnalytics();\n     }\n\n\n    /*\n     * Comscore\n     */\n    var setupComscore = function() {\n        _comscore.push({ c1: \"2\", c2: \"17691522\" });\n\n        (function() {\n            var s = document.createElement(\"script\"), el = document.getElementsByTagName(\"script\")[0]; s.async = true;\n            s.src = (document.location.protocol == \"https:\" ? \"https://sb\" : \"http://b\") + \".scorecardresearch.com/beacon.js\";\n            el.parentNode.insertBefore(s, el);\n        })();\n    }\n\n    /*\n     * Nielson\n     */\n    var setupNielson = function() {\n        (function () {\n            var d = new Image(1, 1);\n            d.onerror = d.onload = function () { d.onerror = d.onload = null; };\n            d.src = [\"//secure-us.imrworldwide.com/cgi-bin/m?ci=us-803244h&cg=0&cc=1&si=\", escape(window.location.href), \"&rp=\", escape(document.referrer), \"&ts=compact&rnd=\", (new Date()).getTime()].join('');\n        })();\n    }\n\n    /*\n     * Chartbeat\n     */\n    var setupChartbeat = function() {\n        /** CONFIGURATION START **/\n        _sf_async_config.uid = 18888;\n        _sf_async_config.domain = \"npr.org\";\n        /** CONFIGURATION END **/\n        (function(){\n            function loadChartbeat() {\n                window._sf_endpt=(new Date()).getTime();\n                var e = document.createElement(\"script\");\n                e.setAttribute(\"language\", \"javascript\");\n                e.setAttribute(\"type\", \"text/javascript\");\n                e.setAttribute(\"src\",\n                    ((\"https:\" == document.location.protocol) ?\n                     \"https://a248.e.akamai.net/chartbeat.download.akamai.com/102508/\" :\n                     \"http://static.chartbeat.com/\") +\n                    \"js/chartbeat.js\");\n                document.body.appendChild(e);\n            }\n            var oldonload = window.onload;\n            window.onload = (typeof window.onload != \"function\") ?\n                loadChartbeat : function() { oldonload(); loadChartbeat(); };\n        })();\n    }\n\n    /*\n     * Event tracking.\n     */\n    var trackEvent = function(eventName, label, value) {\n        var eventData = {\n            'hitType': 'event',\n            'eventCategory': APP_CONFIG.PROJECT_SLUG,\n            'eventAction': eventName\n        }\n\n        if (label) {\n            eventData['eventLabel'] = label;\n        }\n\n        if (value) {\n            eventData['eventValue'] = value\n        }\n\n        ga('send', eventData);\n    }\n\n    // SHARING\n\n    var openShareDiscuss = function() {\n        trackEvent('open-share-discuss');\n    }\n\n    var closeShareDiscuss = function() {\n        trackEvent('close-share-discuss');\n    }\n\n    var clickTweet = function(location) {\n        trackEvent('tweet', location);\n    }\n\n    var clickFacebook = function(location) {\n        trackEvent('facebook', location);\n    }\n\n    var clickEmail = function(location) {\n        trackEvent('email', location);\n    }\n\n    var postComment = function() {\n        trackEvent('new-comment');\n    }\n\n    var actOnFeaturedTweet = function(action, tweet_url) {\n        trackEvent('featured-tweet-action', action, null);\n    }\n\n    var actOnFeaturedFacebook = function(action, post_url) {\n        trackEvent('featured-facebook-action', action, null);\n    }\n\n    var copySummary = function() {\n        trackEvent('summary-copied');\n    }\n\n    // NAVIGATION\n    var usedKeyboardNavigation = false;\n\n    var useKeyboardNavigation = function() {\n        if (!usedKeyboardNavigation) {\n            trackEvent('keyboard-nav');\n            usedKeyboardNavigation = true;\n        }\n    }\n\n    var completeTwentyFivePercent =  function() {\n        trackEvent('completion', '0.25');\n    }\n\n    var completeFiftyPercent =  function() {\n        trackEvent('completion', '0.5');\n    }\n\n    var completeSeventyFivePercent =  function() {\n        trackEvent('completion', '0.75');\n    }\n\n    var completeOneHundredPercent =  function() {\n        trackEvent('completion', '1');\n    }\n\n    var startFullscreen = function() {\n        trackEvent('fullscreen-start');\n    }\n\n    var stopFullscreen = function() {\n        trackEvent('fullscreen-stop');\n    }\n\n    var begin = function(location) {\n        trackEvent('begin', location);\n    }\n\n    var readyChromecast = function() {\n        trackEvent('chromecast-ready');\n    }\n\n    var startChromecast = function() {\n        trackEvent('chromecast-start');\n    }\n\n    var stopChromecast = function() {\n        trackEvent('chromecast-stop');\n    }\n\n    // SLIDES\n\n    var exitSlide = function(slide_index) {\n        var currentTime = new Date();\n        timeOnLastSlide = Math.abs(currentTime - slideStartTime);\n        slideStartTime = currentTime;\n        trackEvent('slide-exit', slide_index, timeOnLastSlide);\n    }\n\n    setupGoogle();\n    setupComscore();\n    setupNielson();\n\n    return {\n        'setupChartbeat': setupChartbeat,\n        'trackEvent': trackEvent,\n        'openShareDiscuss': openShareDiscuss,\n        'closeShareDiscuss': closeShareDiscuss,\n        'clickTweet': clickTweet,\n        'clickFacebook': clickFacebook,\n        'clickEmail': clickEmail,\n        'postComment': postComment,\n        'actOnFeaturedTweet': actOnFeaturedTweet,\n        'actOnFeaturedFacebook': actOnFeaturedFacebook,\n        'copySummary': copySummary,\n        'useKeyboardNavigation': useKeyboardNavigation,\n        'completeTwentyFivePercent': completeTwentyFivePercent,\n        'completeFiftyPercent': completeFiftyPercent,\n        'completeSeventyFivePercent': completeSeventyFivePercent,\n        'completeOneHundredPercent': completeOneHundredPercent,\n        'exitSlide': exitSlide,\n        'startFullscreen': startFullscreen,\n        'stopFullscreen': stopFullscreen,\n        'begin': begin,\n        'readyChromecast': readyChromecast,\n        'startChromecast': startChromecast,\n        'stopChromecast': stopChromecast\n    };\n}());\n\n\n\n// WEBPACK FOOTER //\n// ./www/js/analytics.js","/*!\n * JavaScript Cookie v2.1.0\n * https://github.com/js-cookie/js-cookie\n *\n * Copyright 2006, 2015 Klaus Hartl & Fagner Brack\n * Released under the MIT license\n */\n(function (factory) {\n\tif (typeof define === 'function' && define.amd) {\n\t\tdefine(factory);\n\t} else if (typeof exports === 'object') {\n\t\tmodule.exports = factory();\n\t} else {\n\t\tvar _OldCookies = window.Cookies;\n\t\tvar api = window.Cookies = factory();\n\t\tapi.noConflict = function () {\n\t\t\twindow.Cookies = _OldCookies;\n\t\t\treturn api;\n\t\t};\n\t}\n}(function () {\n\tfunction extend () {\n\t\tvar i = 0;\n\t\tvar result = {};\n\t\tfor (; i < arguments.length; i++) {\n\t\t\tvar attributes = arguments[ i ];\n\t\t\tfor (var key in attributes) {\n\t\t\t\tresult[key] = attributes[key];\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tfunction init (converter) {\n\t\tfunction api (key, value, attributes) {\n\t\t\tvar result;\n\n\t\t\t// Write\n\n\t\t\tif (arguments.length > 1) {\n\t\t\t\tattributes = extend({\n\t\t\t\t\tpath: '/'\n\t\t\t\t}, api.defaults, attributes);\n\n\t\t\t\tif (typeof attributes.expires === 'number') {\n\t\t\t\t\tvar expires = new Date();\n\t\t\t\t\texpires.setMilliseconds(expires.getMilliseconds() + attributes.expires * 864e+5);\n\t\t\t\t\tattributes.expires = expires;\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tresult = JSON.stringify(value);\n\t\t\t\t\tif (/^[\\{\\[]/.test(result)) {\n\t\t\t\t\t\tvalue = result;\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {}\n\n\t\t\t\tif (!converter.write) {\n\t\t\t\t\tvalue = encodeURIComponent(String(value))\n\t\t\t\t\t\t.replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g, decodeURIComponent);\n\t\t\t\t} else {\n\t\t\t\t\tvalue = converter.write(value, key);\n\t\t\t\t}\n\n\t\t\t\tkey = encodeURIComponent(String(key));\n\t\t\t\tkey = key.replace(/%(23|24|26|2B|5E|60|7C)/g, decodeURIComponent);\n\t\t\t\tkey = key.replace(/[\\(\\)]/g, escape);\n\n\t\t\t\treturn (document.cookie = [\n\t\t\t\t\tkey, '=', value,\n\t\t\t\t\tattributes.expires && '; expires=' + attributes.expires.toUTCString(), // use expires attribute, max-age is not supported by IE\n\t\t\t\t\tattributes.path    && '; path=' + attributes.path,\n\t\t\t\t\tattributes.domain  && '; domain=' + attributes.domain,\n\t\t\t\t\tattributes.secure ? '; secure' : ''\n\t\t\t\t].join(''));\n\t\t\t}\n\n\t\t\t// Read\n\n\t\t\tif (!key) {\n\t\t\t\tresult = {};\n\t\t\t}\n\n\t\t\t// To prevent the for loop in the first place assign an empty array\n\t\t\t// in case there are no cookies at all. Also prevents odd result when\n\t\t\t// calling \"get()\"\n\t\t\tvar cookies = document.cookie ? document.cookie.split('; ') : [];\n\t\t\tvar rdecode = /(%[0-9A-Z]{2})+/g;\n\t\t\tvar i = 0;\n\n\t\t\tfor (; i < cookies.length; i++) {\n\t\t\t\tvar parts = cookies[i].split('=');\n\t\t\t\tvar name = parts[0].replace(rdecode, decodeURIComponent);\n\t\t\t\tvar cookie = parts.slice(1).join('=');\n\n\t\t\t\tif (cookie.charAt(0) === '\"') {\n\t\t\t\t\tcookie = cookie.slice(1, -1);\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tcookie = converter.read ?\n\t\t\t\t\t\tconverter.read(cookie, name) : converter(cookie, name) ||\n\t\t\t\t\t\tcookie.replace(rdecode, decodeURIComponent);\n\n\t\t\t\t\tif (this.json) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tcookie = JSON.parse(cookie);\n\t\t\t\t\t\t} catch (e) {}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (key === name) {\n\t\t\t\t\t\tresult = cookie;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!key) {\n\t\t\t\t\t\tresult[name] = cookie;\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {}\n\t\t\t}\n\n\t\t\treturn result;\n\t\t}\n\n\t\tapi.get = api.set = api;\n\t\tapi.getJSON = function () {\n\t\t\treturn api.apply({\n\t\t\t\tjson: true\n\t\t\t}, [].slice.call(arguments));\n\t\t};\n\t\tapi.defaults = {};\n\n\t\tapi.remove = function (key, attributes) {\n\t\t\tapi(key, '', extend(attributes, {\n\t\t\t\texpires: -1\n\t\t\t}));\n\t\t};\n\n\t\tapi.withConverter = init;\n\n\t\treturn api;\n\t}\n\n\treturn init(function () {});\n}));\n\n\n\n// WEBPACK FOOTER //\n// ./www/js/lib/cookie.js","/**\n * cross-storage - Cross domain local storage\n *\n * @version   0.8.1\n * @link      https://github.com/zendesk/cross-storage\n * @author    Daniel St. Jules <danielst.jules@gmail.com>\n * @copyright Zendesk\n * @license   Apache-2.0\n */\n\n;(function(root) {\n  /**\n   * Constructs a new cross storage client given the url to a hub. By default,\n   * an iframe is created within the document body that points to the url. It\n   * also accepts an options object, which may include a timeout, frameId, and\n   * promise. The timeout, in milliseconds, is applied to each request and\n   * defaults to 5000ms. The options object may also include a frameId,\n   * identifying an existing frame on which to install its listeners. If the\n   * promise key is supplied the constructor for a Promise, that Promise library\n   * will be used instead of the default window.Promise.\n   *\n   * @example\n   * var storage = new CrossStorageClient('https://store.example.com/hub.html');\n   *\n   * @example\n   * var storage = new CrossStorageClient('https://store.example.com/hub.html', {\n   *   timeout: 5000,\n   *   frameId: 'storageFrame'\n   * });\n   *\n   * @constructor\n   *\n   * @param {string} url    The url to a cross storage hub\n   * @param {object} [opts] An optional object containing additional options,\n   *                        including timeout, frameId, and promise\n   *\n   * @property {string}   _id        A UUID v4 id\n   * @property {function} _promise   The Promise object to use\n   * @property {string}   _frameId   The id of the iFrame pointing to the hub url\n   * @property {string}   _origin    The hub's origin\n   * @property {object}   _requests  Mapping of request ids to callbacks\n   * @property {bool}     _connected Whether or not it has connected\n   * @property {bool}     _closed    Whether or not the client has closed\n   * @property {int}      _count     Number of requests sent\n   * @property {function} _listener  The listener added to the window\n   * @property {Window}   _hub       The hub window\n   */\n  function CrossStorageClient(url, opts) {\n    opts = opts || {};\n\n    this._id        = CrossStorageClient._generateUUID();\n    this._promise   = opts.promise || Promise;\n    this._frameId   = opts.frameId || 'CrossStorageClient-' + this._id;\n    this._origin    = CrossStorageClient._getOrigin(url);\n    this._requests  = {};\n    this._connected = false;\n    this._closed    = false;\n    this._count     = 0;\n    this._timeout   = opts.timeout || 5000;\n    this._listener  = null;\n\n    this._installListener();\n\n    var frame;\n    if (opts.frameId) {\n      frame = document.getElementById(opts.frameId);\n    }\n\n    // If using a passed iframe, poll the hub for a ready message\n    if (frame) {\n      this._poll();\n    }\n\n    // Create the frame if not found or specified\n    frame = frame || this._createFrame(url);\n    this._hub = frame.contentWindow;\n  }\n\n  /**\n   * The styles to be applied to the generated iFrame. Defines a set of properties\n   * that hide the element by positioning it outside of the visible area, and\n   * by modifying its display.\n   *\n   * @member {Object}\n   */\n  CrossStorageClient.frameStyle = {\n    display:  'none',\n    position: 'absolute',\n    top:      '-999px',\n    left:     '-999px'\n  };\n\n  /**\n   * Returns the origin of an url, with cross browser support. Accommodates\n   * the lack of location.origin in IE, as well as the discrepancies in the\n   * inclusion of the port when using the default port for a protocol, e.g.\n   * 443 over https. Defaults to the origin of window.location if passed a\n   * relative path.\n   *\n   * @param   {string} url The url to a cross storage hub\n   * @returns {string} The origin of the url\n   */\n  CrossStorageClient._getOrigin = function(url) {\n    var uri, protocol, origin;\n\n    uri = document.createElement('a');\n    uri.href = url;\n\n    if (!uri.host) {\n      uri = window.location;\n    }\n\n    if (!uri.protocol || uri.protocol === ':') {\n      protocol = window.location.protocol;\n    } else {\n      protocol = uri.protocol;\n    }\n\n    origin = protocol + '//' + uri.host;\n    origin = origin.replace(/:80$|:443$/, '');\n\n    return origin;\n  };\n\n  /**\n   * UUID v4 generation, taken from: http://stackoverflow.com/questions/\n   * 105034/how-to-create-a-guid-uuid-in-javascript/2117523#2117523\n   *\n   * @returns {string} A UUID v4 string\n   */\n  CrossStorageClient._generateUUID = function() {\n    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n      var r = Math.random() * 16|0, v = c == 'x' ? r : (r&0x3|0x8);\n\n      return v.toString(16);\n    });\n  };\n\n  /**\n   * Returns a promise that is fulfilled when a connection has been established\n   * with the cross storage hub. Its use is required to avoid sending any\n   * requests prior to initialization being complete.\n   *\n   * @returns {Promise} A promise that is resolved on connect\n   */\n  CrossStorageClient.prototype.onConnect = function() {\n    var client = this;\n\n    if (this._connected) {\n      return this._promise.resolve();\n    } else if (this._closed) {\n      return this._promise.reject(new Error('CrossStorageClient has closed'));\n    }\n\n    // Queue connect requests for client re-use\n    if (!this._requests.connect) {\n      this._requests.connect = [];\n    }\n\n    return new this._promise(function(resolve, reject) {\n      var timeout = setTimeout(function() {\n        reject(new Error('CrossStorageClient could not connect'));\n      }, client._timeout);\n\n      client._requests.connect.push(function(err) {\n        clearTimeout(timeout);\n        if (err) return reject(err);\n\n        resolve();\n      });\n    });\n  };\n\n  /**\n   * Sets a key to the specified value, optionally accepting a ttl to passively\n   * expire the key after a number of milliseconds. Returns a promise that is\n   * fulfilled on success, or rejected if any errors setting the key occurred,\n   * or the request timed out.\n   *\n   * @param   {string}  key   The key to set\n   * @param   {*}       value The value to assign\n   * @param   {int}     ttl   Time to live in milliseconds\n   * @returns {Promise} A promise that is settled on hub response or timeout\n   */\n  CrossStorageClient.prototype.set = function(key, value, ttl) {\n    return this._request('set', {\n      key:   key,\n      value: value,\n      ttl:   ttl\n    });\n  };\n\n  /**\n   * Accepts one or more keys for which to retrieve their values. Returns a\n   * promise that is settled on hub response or timeout. On success, it is\n   * fulfilled with the value of the key if only passed a single argument.\n   * Otherwise it's resolved with an array of values. On failure, it is rejected\n   * with the corresponding error message.\n   *\n   * @param   {...string} key The key to retrieve\n   * @returns {Promise}   A promise that is settled on hub response or timeout\n   */\n  CrossStorageClient.prototype.get = function(key) {\n    var args = Array.prototype.slice.call(arguments);\n\n    return this._request('get', {keys: args});\n  };\n\n  /**\n   * Accepts one or more keys for deletion. Returns a promise that is settled on\n   * hub response or timeout.\n   *\n   * @param   {...string} key The key to delete\n   * @returns {Promise}   A promise that is settled on hub response or timeout\n   */\n  CrossStorageClient.prototype.del = function() {\n    var args = Array.prototype.slice.call(arguments);\n\n    return this._request('del', {keys: args});\n  };\n\n  /**\n   * Returns a promise that, when resolved, indicates that all localStorage\n   * data has been cleared.\n   *\n   * @returns {Promise} A promise that is settled on hub response or timeout\n   */\n  CrossStorageClient.prototype.clear = function() {\n    return this._request('clear');\n  };\n\n  /**\n   * Returns a promise that, when resolved, passes an array of all keys\n   * currently in storage.\n   *\n   * @returns {Promise} A promise that is settled on hub response or timeout\n   */\n  CrossStorageClient.prototype.getKeys = function() {\n    return this._request('getKeys');\n  };\n\n  /**\n   * Deletes the iframe and sets the connected state to false. The client can\n   * no longer be used after being invoked.\n   */\n  CrossStorageClient.prototype.close = function() {\n    var frame = document.getElementById(this._frameId);\n    if (frame) {\n      frame.parentNode.removeChild(frame);\n    }\n\n    // Support IE8 with detachEvent\n    if (window.removeEventListener) {\n      window.removeEventListener('message', this._listener, false);\n    } else {\n      window.detachEvent('onmessage', this._listener);\n    }\n\n    this._connected = false;\n    this._closed = true;\n  };\n\n  /**\n   * Installs the necessary listener for the window message event. When a message\n   * is received, the client's _connected status is changed to true, and the\n   * onConnect promise is fulfilled. Given a response message, the callback\n   * corresponding to its request is invoked. If response.error holds a truthy\n   * value, the promise associated with the original request is rejected with\n   * the error. Otherwise the promise is fulfilled and passed response.result.\n   *\n   * @private\n   */\n  CrossStorageClient.prototype._installListener = function() {\n    var client = this;\n\n    this._listener = function(message) {\n      var i, origin, error, response;\n\n      // Ignore invalid messages or those after the client has closed\n      if (client._closed || !message.data || typeof message.data !== 'string') {\n        return;\n      }\n\n      // postMessage returns the string \"null\" as the origin for \"file://\"\n      origin = (message.origin === 'null') ? 'file://' : message.origin;\n\n      // Ignore messages not from the correct origin\n      if (origin !== client._origin) return;\n\n      // LocalStorage isn't available in the hub\n      if (message.data === 'cross-storage:unavailable') {\n        if (!client._closed) client.close();\n        if (!client._requests.connect) return;\n\n        error = new Error('Closing client. Could not access localStorage in hub.');\n        for (i = 0; i < client._requests.connect.length; i++) {\n          client._requests.connect[i](error);\n        }\n\n        return;\n      }\n\n      // Handle initial connection\n      if (message.data.indexOf('cross-storage:') !== -1 && !client._connected) {\n        client._connected = true;\n        if (!client._requests.connect) return;\n\n        for (i = 0; i < client._requests.connect.length; i++) {\n          client._requests.connect[i](error);\n        }\n        delete client._requests.connect;\n      }\n\n      if (message.data === 'cross-storage:ready') return;\n\n      // All other messages\n      try {\n        response = JSON.parse(message.data);\n      } catch(e) {\n        return;\n      }\n\n      if (!response.id) return;\n\n      if (client._requests[response.id]) {\n        client._requests[response.id](response.error, response.result);\n      }\n    };\n\n    // Support IE8 with attachEvent\n    if (window.addEventListener) {\n      window.addEventListener('message', this._listener, false);\n    } else {\n      window.attachEvent('onmessage', this._listener);\n    }\n  };\n\n  /**\n   * Invoked when a frame id was passed to the client, rather than allowing\n   * the client to create its own iframe. Polls the hub for a ready event to\n   * establish a connected state.\n   */\n  CrossStorageClient.prototype._poll = function() {\n    var client, interval, targetOrigin;\n\n    client = this;\n\n    // postMessage requires that the target origin be set to \"*\" for \"file://\"\n    targetOrigin = (client._origin === 'file://') ? '*' : client._origin;\n\n    interval = setInterval(function() {\n      if (client._connected) return clearInterval(interval);\n      if (!client._hub) return;\n\n      client._hub.postMessage('cross-storage:poll', targetOrigin);\n    }, 1000);\n  };\n\n  /**\n   * Creates a new iFrame containing the hub. Applies the necessary styles to\n   * hide the element from view, prior to adding it to the document body.\n   * Returns the created element.\n   *\n   * @private\n   *\n   * @param  {string}            url The url to the hub\n   * returns {HTMLIFrameElement} The iFrame element itself\n   */\n  CrossStorageClient.prototype._createFrame = function(url) {\n    var frame, key;\n\n    frame = window.document.createElement('iframe');\n    frame.id = this._frameId;\n\n    // Style the iframe\n    for (key in CrossStorageClient.frameStyle) {\n      if (CrossStorageClient.frameStyle.hasOwnProperty(key)) {\n        frame.style[key] = CrossStorageClient.frameStyle[key];\n      }\n    }\n\n    window.document.body.appendChild(frame);\n    frame.src = url;\n\n    return frame;\n  };\n\n  /**\n   * Sends a message containing the given method and params to the hub. Stores\n   * a callback in the _requests object for later invocation on message, or\n   * deletion on timeout. Returns a promise that is settled in either instance.\n   *\n   * @private\n   *\n   * @param   {string}  method The method to invoke\n   * @param   {*}       params The arguments to pass\n   * @returns {Promise} A promise that is settled on hub response or timeout\n   */\n  CrossStorageClient.prototype._request = function(method, params) {\n    var req, client;\n\n    if (this._closed) {\n      return this._promise.reject(new Error('CrossStorageClient has closed'));\n    }\n\n    client = this;\n    client._count++;\n\n    req = {\n      id:     this._id + ':' + client._count,\n      method: 'cross-storage:' + method,\n      params: params\n    };\n\n    return new this._promise(function(resolve, reject) {\n      var timeout, originalToJSON, targetOrigin;\n\n      // Timeout if a response isn't received after 4s\n      timeout = setTimeout(function() {\n        if (!client._requests[req.id]) return;\n\n        delete client._requests[req.id];\n        reject(new Error('Timeout: could not perform ' + req.method));\n      }, client._timeout);\n\n      // Add request callback\n      client._requests[req.id] = function(err, result) {\n        clearTimeout(timeout);\n        if (err) return reject(new Error(err));\n        resolve(result);\n      };\n\n      // In case we have a broken Array.prototype.toJSON, e.g. because of\n      // old versions of prototype\n      if (Array.prototype.toJSON) {\n        originalToJSON = Array.prototype.toJSON;\n        Array.prototype.toJSON = null;\n      }\n\n      // postMessage requires that the target origin be set to \"*\" for \"file://\"\n      targetOrigin = (client._origin === 'file://') ? '*' : client._origin;\n\n      // Send serialized message\n      client._hub.postMessage(JSON.stringify(req), targetOrigin);\n\n      // Restore original toJSON\n      if (originalToJSON) {\n        Array.prototype.toJSON = originalToJSON;\n      }\n    });\n  };\n\n  /**\n   * Export for various environments.\n   */\n  if (typeof module !== 'undefined' && module.exports) {\n    module.exports = CrossStorageClient;\n  } else if (typeof exports !== 'undefined') {\n    exports.CrossStorageClient = CrossStorageClient;\n  } else if (typeof define === 'function' && define.amd) {\n    define([], function() {\n      return CrossStorageClient;\n    });\n  } else {\n    root.CrossStorageClient = CrossStorageClient;\n  }\n}(this));\n\n\n\n// WEBPACK FOOTER //\n// ./www/js/lib/cross-storage-client.js"],"sourceRoot":""}